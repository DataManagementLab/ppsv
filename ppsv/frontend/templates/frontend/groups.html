{% extends 'frontend/base.html' %}
{% load static %}

{% block groups_page_navbar_container %}
        <form class="navbar-form" action="{% url 'frontend:groups' %}" style="float:left;padding-bottom: 0px">
            <button type="submit" class="navbar-btn" style="color:#0a3d62;padding-top:0.3em;padding-bottom:0.3em;" >
                Your Groups
            </button>
        </form>
{% endblock groups_page_navbar_container %}

{% block content %}
<form method="post" style="margin:0px;padding:0px;">
    {% csrf_token %}
    <div style="display:flex; justify-content: center;">
        <div style="display:grid;align-content: start;width:60%;">
            {% for group_of_student in groups_of_student %}
                {% if group_of_student.size > 1 %}
                    <ul id="{{ group_of_student.id }}" class="responsive-table" style="margin:0px;padding:0px;width:100%;">
                        {% if chosen_group == group_of_student.id %}
                            <div style="display:flex; justify-content:center;">
                                <div id="{{ group_of_student.id }}delete" style="position:absolute;z-index:2;width:59.2%;height:inherit;background-color:rgba(0,0,0,0.8);padding:1%;display:flex;justify-content:center;border-radius:3px;height:500px">
                                   <div style="position:relative;z-index:2;width:450px;box-sizing: content-box;background-color:white;border-radius:3px;display:flex;justify-content:center;align-items: center;flex-direction:column;padding:10px;">
                                       <i class="fa fa-times-circle" aria-hidden="true" style="color:red;font-size:80px;flex: 1.5;"></i>
                                       <span style="font-weight:500;font-size:30px;flex: 0.2;"> Are you sure </span>
                                       <span style="font-weight:500;font-size:18px;flex: 1;"> you want to delete this group ?  </span>
                                       <div style="flex: 1;">
                                           <button style="background-color:rgba(94, 94, 94, 0.8);outline:none;border:none;border-radius:3px;color:white;padding: 10px 20px;margin-right:100px"> Cancel </button>
                                           <button name="delete_group" value="{{ chosen_group }}" style="background-color:red;outline:none;border:none;border-radius:3px;color:white;padding: 10px 20px;"> Delete </button>
                                       </div>
                                   </div>
                                </div>
                            </div>
                        {% endif %}
                        <li class="table-header" style="padding: 15px;text-align:center;position:relative;">
                            <div>
                                {% for members_group, members in members_of_groups.items %}
                                    {% if group_of_student.id == members_group %}
                                        {% for member in members %}
                                            <span> {{ member.student.firstname }} {{ member.student.lastname }}, </span>
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="undecorated-btn" type="submit" name="ask_delete_group" value="{{ group_of_student.id }}" style="position:absolute;right:15px;top:15px;" title="Delete Group">
                                <i class="fa fa-trash" aria-hidden="true" style="color:red;font-size:20px"> </i>
                            </button>
                        </li>
                        {% for members_group, members in members_of_groups.items %}
                            {% if group_of_student.id == members_group %}
                                {% for member in members %}
                                    <li class="table-row" style="position:relative;padding-top:20px;padding-bottom:14px;display:flex;flex-direction:row">
                                        <div style="flex:1"></div>
                                        <button class="undecorated-btn" type="submit" name="remove_student" value="" style="position:absolute;left:15px;top:18px;">
                                          <i class="fa fa-minus" aria-hidden="true" style="color:red;font-size:20px"> </i>
                                        </button>
                                        <div style="flex:1;">{{ member.student.tucan_id }} </div>
                                        <div style="flex:1;">{{ member.student.firstname }} {{ member.student.lastname }}  </div>
                                        <div style="flex:1;display:flex;flex-direction:row">
                                            <button class="undecorated-btn" type="submit" name="open_email_form" value="" style="flex:0.1">
                                                <i class="fa fa-envelope-o" aria-hidden="true" style="font-size:16px"></i>
                                            </button>
                                            <span style="flex:0.1"> {{ member.email }} </span>
                                        </div>
                                    </li>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</form>

<!-- The scroll position is saved and loaded when the page submits a form-->
<script>
    document.addEventListener("DOMContentLoaded", function (event) {
        var scrollpos = sessionStorage.getItem('scrollpos');
        if ({{chosen_group}} != null) {
            console.log(document.getElementById(String({{chosen_group}})).getBoundingClientRect().height);
            document.getElementById(String({{chosen_group}})+"delete").style.height = document.getElementById(String({{chosen_group}})).getBoundingClientRect().height;
        }
        if (scrollpos) {
            window.scrollTo(0, scrollpos);
            sessionStorage.removeItem('scrollpos');
        }
    });

    window.addEventListener("beforeunload", function (e) {
           sessionStorage.setItem('scrollpos', window.scrollY);
    });

</script>
{% endblock content %}